<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BITopia - Mapa Gigante</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <style>
    body { margin: 0; }
    canvas { display: block; margin: auto; }
  </style>
</head>
<body>
<script>
  const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    backgroundColor: '#a0d0ff',
    physics: {
      default: 'arcade',
      arcade: { debug: false }
    },
    scene: {
      preload,
      create,
      update
    },
    scale: {
      mode: Phaser.Scale.RESIZE,
      autoCenter: Phaser.Scale.CENTER_BOTH
    },
  };

  const game = new Phaser.Game(config);

  let map;
  let camera;
  let selectedBuilding = 'house';
  let buildingsGroup;
  let creaturesGroup;  // Grupo para las criaturas

  function preload() {
    this.load.image('tile', 'https://labs.phaser.io/assets/sprites/platform.png');  // Suelo base
    this.load.image('house', 'https://labs.phaser.io/assets/sprites/wood.png');  // Imagen de la casa
    this.load.image('creature', 'https://labs.phaser.io/assets/sprites/bee.png');  // Imagen para la criatura
  }

  function create() {
    // Crear el mapa gigante de 4000x4000 pÃ­xeles
    map = this.add.tilemap();
    const tileset = map.addTilesetImage('tile');
    map.createLayer(0, tileset, 0, 0).setScale(2);

    camera = this.cameras.main;
    camera.setBounds(0, 0, 4000, 4000);

    buildingsGroup = this.physics.add.group();
    creaturesGroup = this.physics.add.group();

    // Control de desplazamiento con las teclas
    this.input.keyboard.on('keydown-W', () => camera.scrollY -= 10);
    this.input.keyboard.on('keydown-S', () => camera.scrollY += 10);
    this.input.keyboard.on('keydown-A', () => camera.scrollX -= 10);
    this.input.keyboard.on('keydown-D', () => camera.scrollX += 10);

    // Control de zoom
    this.input.mouse.disableContextMenu();
    this.input.on('wheel', function(pointer, gameObjects, deltaX, deltaY) {
      const zoomSpeed = 0.1;
      if (deltaY < 0) {
        camera.zoom = Math.min(camera.zoom + zoomSpeed, 2);
      } else {
        camera.zoom = Math.max(camera.zoom - zoomSpeed, 0.5);
      }
    });

    // Control para construir edificios al hacer clic
    this.input.on('pointerdown', function(pointer) {
      if (selectedBuilding === 'house') {
        let building = buildingsGroup.create(pointer.x + camera.scrollX, pointer.y + camera.scrollY, 'house');
        building.setOrigin(0.5, 0.5);
      }
    });

    // Crear criaturas en posiciones aleatorias
    for (let i = 0; i < 5; i++) {
      let x = Phaser.Math.Between(100, 4000);
      let y = Phaser.Math.Between(100, 4000);
      let creature = creaturesGroup.create(x, y, 'creature');
      creature.setOrigin(0.5, 0.5);
      creature.speed = 50;  // Velocidad de movimiento
      creature.setData('target', null);  // Objetivo inicial
    }
  }

  function update() {
    creaturesGroup.getChildren().forEach(creature => {
      if (creature.getData('target') === null) {
        // Movimiento aleatorio de las criaturas
        let randomDirection = Phaser.Math.Between(0, 3);
        let targetX = creature.x;
        let targetY = creature.y;

        switch (randomDirection) {
          case 0: targetX += 100; break;  // Mover a la derecha
          case 1: targetX -= 100; break;  // Mover a la izquierda
          case 2: targetY += 100; break;  // Mover abajo
          case 3: targetY -= 100; break;  // Mover arriba
        }

        creature.setData('target', { x: targetX, y: targetY });
      }

      // Movimiento hacia el objetivo
      let target = creature.getData('target');
      if (target) {
        let angle = Phaser.Math.Angle.Between(creature.x, creature.y, target.x, target.y);
        creature.setVelocityX(creature.speed * Math.cos(angle));
        creature.setVelocityY(creature.speed * Math.sin(angle));

        // Si la criatura llega al objetivo, seleccionar un nuevo objetivo
        if (Phaser.Math.Distance.Between(creature.x, creature.y, target.x, target.y) < 10) {
          creature.setData('target', null);  // Resetear el objetivo
        }
      }
    });
  }

</script>
</body>
</html>
